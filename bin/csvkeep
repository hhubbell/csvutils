#!/usr/bin/env python
#
# The opposite of csvdrop
#

import argparse
import csvutils as cu
import sys

def imask(vals, indexes):
    """
    Mask a list based on a list of indexes
    :param vals:        List to mask
    :param indexes:     List of indexes to apply
    :return list:       Masked list
    """
    return [x for i, x in enumerate(vals) if i in indexes]


if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('infile', nargs='?',
        type=argparse.FileType('r'),
        default=sys.stdin)
    parser.add_argument('cols',
        nargs='+')
    parser.add_argument('-d', '--delim',
        nargs='?',
        default=',')

    args = parser.parse_args()
    
    outfile = sys.stdout
    delim = args.delim.decode('string-escape')

    header, rows = cu.read(args.infile, delimiter=delim)
    keeps = cu.indexes(header, args.cols)

    mheader = imask(header, keeps)
    mrows = [imask(x, keeps) for x in rows]

    cu.write(outfile, mheader, mrows)
